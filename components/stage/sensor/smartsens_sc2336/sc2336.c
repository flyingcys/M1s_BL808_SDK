#include <bl808.h>
#include "sensor_internal.h"
#include "sccb.h"
#include <math.h>

/* sc2336 sensor info */
#define SLAVE_ADDR                  0x30
#define SENSOR_ID_H                 0xcb
#define SENSOR_ID_L                 0x3a
#define MIN_EXPO_TIME               143282                       /* 143282 ns, 4 line */
#define MAX_EXPO_TIME               EXPO_TIME_1_25_SEC          /* 1/25 sec */
#define REG_ADDR_BIT                SENSOR_REG_ADDR_16BIT


#define MAX_GAIN                    GAIN_DB_FLOAT_TO_INT(42.14)   /* limit max gain to 30.10(A) + 12.04(D) dB or 128x to avoid bad noise */
//#define MAX_AGAIN                   GAIN_DB_FLOAT_TO_INT(30)   /* 30 dB or 32x */
#define MIN_GAIN                    GAIN_DB_FLOAT_TO_INT(0)       /* 0db or 1X */
#define MIN_GAIN_STEP               (GAIN_6_DB / 32)            /* 0.274 dB */


/* sc2336 registers */
#define REG_SENSOR_ID_H             0x3107
#define REG_SENSOR_ID_L             0x3108

#define REG_GROUP_HOLD              0x3812

#define REG_DIG_GAIN                0x3e06
#define REG_DIG_FINE_GAIN           0x3e07
#define REG_ANG_GAIN                0x3e09

#define REG_SHUTTER_TIME_H          0x3e00
#define REG_SHUTTER_TIME_M          0x3e01
#define REG_SHUTTER_TIME_L          0x3e02

#define REG_TOTAL_WIDTH_H           0x320c //HTS,line width
#define REG_TOTAL_WIDTH_L           0x320d
#define REG_TOTAL_HEIGHT_H          0x320e  //VTS,frame hight
#define REG_TOTAL_HEIGHT_L          0x320f

#define REG_OUT_WIDTH_H             0x3208  //width
#define REG_OUT_WIDTH_L             0x3209
#define REG_OUT_HEIHT_H             0x320a  //hight
#define REG_OUT_HEIHT_L             0x320b

#define REG_OUT_START_PIXEL_H       0x3210  //  start X
#define REG_OUT_START_PIXEL_L       0x3211
#define REG_OUT_START_LINE_H        0x3212  //  start Y
#define REG_OUT_START_LINE_L        0x3213

#define REG_FLIP_MIRROR             0x3221

#define enable_test_pattern         0
#define REG_test_pattern            0x4501
#define enable_sensor_dpc           0
#define REG_sensor_dpc              0x5000


typedef enum {
    FORMAT_INDEX_DVP_1080P_25 = 0,
    FORMAT_INDEX_MIPI_1_LANE_1080P_25,
    FORMAT_INDEX_MIPI_2_LANE_1080P_25,
    FORMAT_INDEX_DVP_720P_60,
    FORMAT_INDEX_DVP_720P_30,
    FORMAT_INDEX_DVP_1080P_30,
    FORMAT_INDEX_MIPI_2_LANE_1080P_15,
    FORMAT_INDEX_MIPI_2_LANE_1080P_30,
    FORMAT_INDEX_MIPI_2_LANE_720P_25,
    FORMAT_INDEX_MIPI_2_LANE_720P_30,
    FORMAT_INDEX_MIPI_2_LANE_720P_50,
    FORMAT_INDEX_MIPI_2_LANE_720P_60,
    FORMAT_INDEX_INVALID,
} FORMAT_INDEX;

static fps_info_t fps_tbl = {0};
uint64_t MAX_AGAIN = 32; // 最大模拟gain ,可变

static const sensor_format_t format_info[] = {
    {   /*  DVP 1080p25 */ //cleaned_0x27_SC2336_DVP_24Minput_66Mpclk_10bit_1920x1080_25fps
        .total_width    = 2250,
        .total_height   = 1200,
        .pix_clk        = 66000000,
        .fps            = 25,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 1lane 1080p25 */ //cleaned_0x29_SC2336_MIPI_24Minput_1lane_660Mbps_10bit_1920x1080_25fps
        .total_width    = 1125,
        .total_height   = 1200,
        .pix_clk        = 66000000,
        .fps            = 25,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 1080p25  */ //cleaned_0x28_SC2336_MIPI_24Minput_2lane_330Mbps_10bit_1920x1080_25fps
        .total_width    = 2250,
        .total_height   = 1200,
        .pix_clk        = 66000000,
        .fps            = 25,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  DVP 720p60  */ //cleaned_0x38_SC2336_DVP_24Minput_78Mpclk_10bit_1280x720_60fps_0x3D08_0x01
        .total_width    = 1706,
        .total_height   = 762,
        .pix_clk        = 78000000,
        .fps            = 60,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  DVP 720p30  */ //cleaned_0x2a_SC2336_DVP_24Minput_49.5Mpclk_10bit_1280x720_30fps
        .total_width    = 2200,
        .total_height   = 750,
        .pix_clk        = 49500000,
        .fps            = 30,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  DVP 1080p30 */ //cleaned_0x31_SC2336_DVP_24Minput_78Mpclk_10bit_1920x1080_30fps
        .total_width    = 2255,
        .total_height   = 1153,
        .pix_clk        = 78000000,
        .fps            = 30,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 1080p15  */ //cleaned_0x02_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1920x1080_30fps -> change frame length
        .total_width    = 2250,
        .total_height   = 2400,
        .pix_clk        = 81000000,
        .fps            = 15,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 1080p30  */ //cleaned_0x02_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1920x1080_30fps
        .total_width    = 2250,
        .total_height   = 1200,
        .pix_clk        = 81000000,
        .fps            = 30,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 720p25  */ //cleaned_0x2d_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_25fps
        .total_width    = 1800,
        .total_height   = 1800,
        .pix_clk        = 81000000,
        .fps            = 25,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 720p30  */ //cleaned_0x2e_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_30fps
        .total_width    = 1800,
        .total_height   = 1500,
        .pix_clk        = 81000000,
        .fps            = 30,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 720p50  */ //cleaned_0x2f_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_50fps
        .total_width    = 1800,
        .total_height   = 900,
        .pix_clk        = 81000000,
        .fps            = 50,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
    {   /*  MIPI 2lane 720p60  */ //cleaned_0x30_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_60fps
        .total_width    = 1800,
        .total_height   = 750,
        .pix_clk        = 81000000,
        .fps            = 60,
        .bayer_pattern = BAYER_PATTERN_BG,
    },
};

static const int sc2336_mode[] = {\
    DSP2_INPUT_DVP,\
    DSP2_INPUT_MIPI_1LANE,\
    DSP2_INPUT_MIPI_2LANE,\
};

static const sensor_reg_16_8_t init_reglist_MIPI_1lane_1080p_25fps[] =
{
  //cleaned_0x29_SC2336_MIPI_24Minput_1lane_660Mbps_10bit_1920x1080_25fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x3018,0x12},
    {0x3019,0x0e},
    {0x301f,0x29},
    {0x3106,0x05},
    {0x320e,0x04},
    {0x320f,0xb0},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ec,0x0c},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x4a},
    {0x3e02,0xf0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x08},
    {0x481b,0x05},
    {0x481d,0x12},
    {0x481f,0x04},
    {0x4821,0x0a},
    {0x4823,0x04},
    {0x4825,0x04},
    {0x4827,0x04},
    {0x4829,0x07},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x20},
    {0x37f9,0x27},
    {0x0100,0x01},
   /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_1080p_25fps[] =
{
    //cleaned_0x28_SC2336_MIPI_24Minput_2lane_330Mbps_10bit_1920x1080_25fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x28},
    {0x3106,0x05},
    {0x320e,0x04},
    {0x320f,0xb0},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x4a},
    {0x3e02,0xf0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x20},
    {0x37f9,0x27},
    {0x0100,0x01},
       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_720p_25fps[] =
{
    //cleaned_0x2d_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_25fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x2d},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x34},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x53},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320c,0x07},
    {0x320d,0x08},
    {0x320e,0x07},
    {0x320f,0x08},
    {0x3210,0x00},
    {0x3211,0x10},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0x30},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x70},
    {0x3e02,0x20},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},
       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_720p_30fps[] =
{
    //cleaned_0x2e_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_30fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x2e},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x34},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x53},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320c,0x07},
    {0x320d,0x08},
    {0x320e,0x05},
    {0x320f,0xdc},
    {0x3210,0x00},
    {0x3211,0x10},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0x30},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x5d},
    {0x3e02,0x60},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},
       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_720p_50fps[] =
{
    //cleaned_0x2f_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_50fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x2f},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x34},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x53},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320c,0x07},
    {0x320d,0x08},
    {0x320e,0x03},
    {0x320f,0x84},
    {0x3210,0x00},
    {0x3211,0x10},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0x30},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x37},
    {0x3e02,0xe0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},

       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_720p_60fps[] =
{
    //cleaned_0x30_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1280x720_60fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x30},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x34},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x53},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320c,0x07},
    {0x320d,0x08},
    {0x320e,0x02},
    {0x320f,0xee},
    {0x3210,0x00},
    {0x3211,0x10},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0x30},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x2e},
    {0x3e02,0x80},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},

       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_1080p_15fps[] =
{
    //cleaned_0x02_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1920x1080_30fps -> change frame length
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x02},
    {0x3106,0x05},
    {0x320c,0x08},
    {0x320d,0xca},
    {0x320e,0x09},
    {0x320f,0x60},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x4a},
    {0x3e02,0xa0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},
       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_MIPI_2lane_1080p_30fps[] =
{
    //cleaned_0x02_SC2336_MIPI_24Minput_2lane_405Mbps_10bit_1920x1080_30fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x301f,0x02},
    {0x3106,0x05},
    {0x320c,0x08},
    {0x320d,0xca},
    {0x320e,0x04},
    {0x320f,0xb0},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x09},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x09},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x37},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x4a},
    {0x3e02,0xa0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4819,0x06},
    {0x481b,0x03},
    {0x481d,0x0b},
    {0x481f,0x03},
    {0x4821,0x08},
    {0x4823,0x03},
    {0x4825,0x03},
    {0x4827,0x03},
    {0x4829,0x05},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x53},
    {0x37f9,0x53},
    {0x0100,0x01},
       /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_25fps[] =
{
    //cleaned_0x27_SC2336_DVP_24Minput_66Mpclk_10bit_1920x1080_25fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x3001,0xff},
    {0x3002,0xf0},
    {0x300a,0x24},
    {0x3018,0x0f},
    {0x301a,0xf8},
    {0x301c,0x94},
    {0x301f,0x27},
    {0x3030,0x01},
    {0x303f,0x81},
    {0x3106,0x05},
    {0x320e,0x04},
    {0x320f,0xb0},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3000,0xff},
    {0x3e01,0x20},
    {0x3e02,0xf0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4603,0x09},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x20},
    {0x37f9,0x27},
    {0x0100,0x01},
    /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_720p_60fps[] =
{
    //cleaned_0x38_SC2336_DVP_24Minput_78Mpclk_10bit_1280x720_60fps_0x3D08_0x01
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x3001,0xff},
    {0x3002,0xf0},
    {0x300a,0x24},
    {0x3018,0x0f},
    {0x301a,0xf8},
    {0x301c,0x94},
    {0x301f,0x38},
    {0x3030,0x01},
    {0x303f,0x81},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x34},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x53},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320c,0x06},
    {0x320d,0xaa},
    {0x320e,0x02},
    {0x320f,0xfa},
    {0x3210,0x00},
    {0x3211,0x10},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0x90},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0x30},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x0d},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x0d},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x17},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3000,0xff},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    //{0x3d08,0x01},
    {0x3d08,0x00},//極性
    {0x3e01,0x2f},
    {0x3e02,0x20},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4603,0x09},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x50},
    {0x37f9,0x53},
    {0x0100,0x01},
    /* end of reg list */
    {REGLIST_END, 0x00},

};

static const sensor_reg_16_8_t init_reglist_720p_30fps[] =
{
    //cleaned_0x2a_SC2336_DVP_24Minput_49.5Mpclk_10bit_1280x720_30fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x3001,0xff},
    {0x3002,0xf0},
    {0x300a,0x24},
    {0x3018,0x0f},
    {0x301a,0xf8},
    {0x301c,0x94},
    {0x301f,0x2a},
    {0x3030,0x01},
    {0x303f,0x81},
    {0x3106,0x05},
    {0x3200,0x01},
    {0x3201,0x40},
    {0x3202,0x00},
    {0x3203,0xb4},
    {0x3204,0x06},
    {0x3205,0x47},
    {0x3206,0x03},
    {0x3207,0x8b},
    {0x3208,0x05},
    {0x3209,0x00},
    {0x320a,0x02},
    {0x320b,0xd0},
    {0x320e,0x02},
    {0x320f,0xee},
    {0x3210,0x00},
    {0x3211,0x04},
    {0x3212,0x00},
    {0x3213,0x04},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xd0},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x84},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x0b},
    {0x3000,0xff},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0xcb},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x07},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3e01,0x2e},
    {0x3e02,0x90},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4603,0x09},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x51},
    {0x37f9,0x53},
    {0x0100,0x01},

    /* end of reg list */
    {REGLIST_END, 0x00},
};

static const sensor_reg_16_8_t init_reglist_30fps[] =
{
    //cleaned_0x31_SC2336_DVP_24Minput_78Mpclk_10bit_1920x1080_30fps
    {0x0103,0x01},
    {0x0100,0x00},
    {0x36e9,0x80},
    {0x37f9,0x80},
    {0x3001,0xff},
    {0x3002,0xf0},
    {0x300a,0x24},
    {0x3018,0x0f},
    {0x301a,0xf8},
    {0x301c,0x94},
    {0x301f,0x31},
    {0x3030,0x01},
    {0x303f,0x81},
    {0x3106,0x05},
    {0x320c,0x08},
    {0x320d,0xcf},
    {0x320e,0x04},
    {0x320f,0x81},
    {0x3248,0x04},
    {0x3249,0x0b},
    {0x3253,0x08},
    {0x3301,0x09},
    {0x3302,0xff},
    {0x3303,0x10},
    {0x3306,0x60},
    {0x3307,0x02},
    {0x330a,0x01},
    {0x330b,0x10},
    {0x330c,0x16},
    {0x330d,0xff},
    {0x3318,0x02},
    {0x3321,0x0a},
    {0x3327,0x0e},
    {0x332b,0x12},
    {0x3333,0x10},
    {0x3334,0x40},
    {0x335e,0x06},
    {0x335f,0x0a},
    {0x3364,0x1f},
    {0x337c,0x02},
    {0x337d,0x0e},
    {0x3390,0x09},
    {0x3391,0x0f},
    {0x3392,0x1f},
    {0x3393,0x20},
    {0x3394,0x20},
    {0x3395,0xff},
    {0x33a2,0x04},
    {0x33b1,0x80},
    {0x33b2,0x68},
    {0x33b3,0x42},
    {0x33f9,0x70},
    {0x33fb,0xc8},
    {0x33fc,0x0f},
    {0x33fd,0x1f},
    {0x349f,0x03},
    {0x34a6,0x0f},
    {0x34a7,0x1f},
    {0x34a8,0x42},
    {0x34a9,0x06},
    {0x34aa,0x01},
    {0x34ab,0x23},
    {0x34ac,0x01},
    {0x34ad,0x78},
    {0x3630,0xf4},
    {0x3633,0x22},
    {0x3639,0xf4},
    {0x363c,0x47},
    {0x3641,0x03},//PAD driving
    {0x3670,0x09},
    {0x3674,0xf4},
    {0x3675,0xfb},
    {0x3676,0xed},
    {0x367c,0x09},
    {0x367d,0x0f},
    {0x3690,0x33},
    {0x3691,0x33},
    {0x3692,0x43},
    {0x3698,0x89},
    {0x3699,0x96},
    {0x369a,0xd0},
    {0x369b,0xd0},
    {0x369c,0x09},
    {0x369d,0x0f},
    {0x36a2,0x09},
    {0x36a3,0x0f},
    {0x36a4,0x1f},
    {0x36d0,0x01},
    {0x36ea,0x0d},
    {0x36eb,0x0c},
    {0x36ec,0x1c},
    {0x36ed,0x28},
    {0x3722,0xe1},
    {0x3724,0x41},
    {0x3725,0xc1},
    {0x3728,0x20},
    {0x37fa,0x0d},
    {0x37fb,0x32},
    {0x37fc,0x11},
    {0x37fd,0x17},
    {0x3900,0x0d},
    {0x3905,0x98},
    {0x3000,0xff},
    {0x391b,0x81},
    {0x391c,0x10},
    {0x3933,0x81},
    {0x3934,0xc5},
    {0x3940,0x68},
    {0x3941,0x00},
    {0x3942,0x01},
    {0x3943,0xc6},
    {0x3952,0x02},
    {0x3953,0x0f},
    {0x3d08,0x00},//極性
    {0x3e01,0x20},//{0x3e01,0x47}, expo
    {0x3e02,0xb0},
    {0x3e08,0x1f},
    {0x3e1b,0x14},
    {0x440e,0x02},
    {0x4509,0x38},
    {0x4603,0x09},
    {0x5799,0x06},
    {0x5ae0,0xfe},
    {0x5ae1,0x40},
    {0x5ae2,0x30},
    {0x5ae3,0x28},
    {0x5ae4,0x20},
    {0x5ae5,0x30},
    {0x5ae6,0x28},
    {0x5ae7,0x20},
    {0x5ae8,0x3c},
    {0x5ae9,0x30},
    {0x5aea,0x28},
    {0x5aeb,0x3c},
    {0x5aec,0x30},
    {0x5aed,0x28},
    {0x5aee,0xfe},
    {0x5aef,0x40},
    {0x5af4,0x30},
    {0x5af5,0x28},
    {0x5af6,0x20},
    {0x5af7,0x30},
    {0x5af8,0x28},
    {0x5af9,0x20},
    {0x5afa,0x3c},
    {0x5afb,0x30},
    {0x5afc,0x28},
    {0x5afd,0x3c},
    {0x5afe,0x30},
    {0x5aff,0x28},
    {0x36e9,0x50},
    {0x37f9,0x53},
    {0x0100,0x01},
    /* end of reg list */
    {REGLIST_END, 0x00},
};

static int enable(sensor_t *sensor)
{
    SCCB_Write_Reg16(sensor->slv_addr, 0x0100, 0x01);       /* enable stream */
    return 0;
}

static int disable(sensor_t *sensor)
{

    SCCB_Write_Reg16(sensor->slv_addr, 0x0100, 0x00);       /* disable stream */
    return 0;
}

/*****************************GC CODE*****************************/

// 因为 sc2336 的 Again 会受 温度影响，Dgain 先起来，再起 Again 

// REG_ANG_GAIN  0x3e09

// 0x00   1X
// 0x08   2X
// 0x09   4X
// 0x0b   8X
// 0x0f   16X
// 0x1f   32X

typedef struct _GAIN_TABLE {
	uint8_t DIG_FINE;
    uint8_t ANG;
    uint8_t DIG;
	uint64_t totol_gain;
} GAIN_TABLE;
static const GAIN_TABLE gain_table[] = {
    //0x3e07         0x3e09    0x3e06     gainX1000
    //DIG_FINE        ANG        DIG    

    // 1X  
    {0x80,0x00,0x0,1000},
    {0x84,0x00,0x0,1031},
    {0x88,0x00,0x0,1063},
    {0x8c,0x00,0x0,1094},
    {0x90,0x00,0x0,1125},
    {0x94,0x00,0x0,1156},
    {0x98,0x00,0x0,1188},
    {0x9c,0x00,0x0,1219},
    {0xa0,0x00,0x0,1250},
    {0xa4,0x00,0x0,1281},
    {0xa8,0x00,0x0,1313},
    {0xac,0x00,0x0,1344},
    {0xb0,0x00,0x0,1375},
    {0xb4,0x00,0x0,1406},
    {0xb8,0x00,0x0,1438},
    {0xbc,0x00,0x0,1469},
    {0xc0,0x00,0x0,1500},
    {0xc4,0x00,0x0,1531},
    {0xc8,0x00,0x0,1563},
    {0xcc,0x00,0x0,1594},
    {0xd0,0x00,0x0,1625},
    {0xd4,0x00,0x0,1656},
    {0xd8,0x00,0x0,1688},
    {0xdc,0x00,0x0,1719},
    {0xe0,0x00,0x0,1750},
    {0xe4,0x00,0x0,1781},
    {0xe8,0x00,0x0,1813},
    {0xec,0x00,0x0,1844},
    {0xf0,0x00,0x0,1875},
    {0xf4,0x00,0x0,1906},
    {0xf8,0x00,0x0,1938},
    {0xfc,0x00,0x0,1969},
    // 2X  
    {0x80,0x00,0x1,2000},
    {0x84,0x00,0x1,2063},
    {0x88,0x00,0x1,2125},
    {0x8c,0x00,0x1,2188},
    {0x90,0x00,0x1,2250},
    {0x94,0x00,0x1,2313},
    {0x98,0x00,0x1,2375},
    {0x9c,0x00,0x1,2438},
    {0xa0,0x00,0x1,2500},
    {0xa4,0x00,0x1,2563},
    {0xa8,0x00,0x1,2625},
    {0xac,0x00,0x1,2688},
    {0xb0,0x00,0x1,2750},
    {0xb4,0x00,0x1,2813},
    {0xb8,0x00,0x1,2875},
    {0xbc,0x00,0x1,2938},
    {0xc0,0x00,0x1,3000},
    {0xc4,0x00,0x1,3063},
    {0xc8,0x00,0x1,3125},
    {0xcc,0x00,0x1,3188},
    {0xd0,0x00,0x1,3250},
    {0xd4,0x00,0x1,3313},
    {0xd8,0x00,0x1,3375},
    {0xdc,0x00,0x1,3438},
    {0xe0,0x00,0x1,3500},
    {0xe4,0x00,0x1,3563},
    {0xe8,0x00,0x1,3625},
    {0xec,0x00,0x1,3688},
    {0xf0,0x00,0x1,3750},
    {0xf4,0x00,0x1,3813},
    {0xf8,0x00,0x1,3875},
    {0xfc,0x00,0x1,3938},
    // 4X
    {0x80,0x08,0x1,4000},
    {0x84,0x08,0x1,4126},
    {0x88,0x08,0x1,4250},
    {0x8c,0x08,0x1,4376},
    {0x90,0x08,0x1,4500},
    {0x94,0x08,0x1,4626},
    {0x98,0x08,0x1,4750},
    {0x9c,0x08,0x1,4876},
    {0xa0,0x08,0x1,5000},
    {0xa4,0x08,0x1,5126},
    {0xa8,0x08,0x1,5250},
    {0xac,0x08,0x1,5376},
    {0xb0,0x08,0x1,5500},
    {0xb4,0x08,0x1,5626},
    {0xb8,0x08,0x1,5750},
    {0xbc,0x08,0x1,5876},
    {0xc0,0x08,0x1,6000},
    {0xc4,0x08,0x1,6126},
    {0xc8,0x08,0x1,6250},
    {0xcc,0x08,0x1,6376},
    {0xd0,0x08,0x1,6500},
    {0xd4,0x08,0x1,6626},
    {0xd8,0x08,0x1,6750},
    {0xdc,0x08,0x1,6876},
    {0xe0,0x08,0x1,7000},
    {0xe4,0x08,0x1,7126},
    {0xe8,0x08,0x1,7250},
    {0xec,0x08,0x1,7376},
    {0xf0,0x08,0x1,7500},
    {0xf4,0x08,0x1,7626},
    {0xf8,0x08,0x1,7750},
    {0xfc,0x08,0x1,7876},
    // 8X
    {0x80,0x09,0x1,8000},
    {0x84,0x09,0x1,8252},
    {0x88,0x09,0x1,8500},
    {0x8c,0x09,0x1,8752},
    {0x90,0x09,0x1,9000},
    {0x94,0x09,0x1,9252},
    {0x98,0x09,0x1,9500},
    {0x9c,0x09,0x1,9752},
    {0xa0,0x09,0x1,10000},
    {0xa4,0x09,0x1,10252},
    {0xa8,0x09,0x1,10500},
    {0xac,0x09,0x1,10752},
    {0xb0,0x09,0x1,11000},
    {0xb4,0x09,0x1,11252},
    {0xb8,0x09,0x1,11500},
    {0xbc,0x09,0x1,11752},
    {0xc0,0x09,0x1,12000},
    {0xc4,0x09,0x1,12252},
    {0xc8,0x09,0x1,12500},
    {0xcc,0x09,0x1,12752},
    {0xd0,0x09,0x1,13000},
    {0xd4,0x09,0x1,13252},
    {0xd8,0x09,0x1,13500},
    {0xdc,0x09,0x1,13752},
    {0xe0,0x09,0x1,14000},
    {0xe4,0x09,0x1,14252},
    {0xe8,0x09,0x1,14500},
    {0xec,0x09,0x1,14752},
    {0xf0,0x09,0x1,15000},
    {0xf4,0x09,0x1,15252},
    {0xf8,0x09,0x1,15500},
    {0xfc,0x09,0x1,15752},
    // 16X
    {0x80,0x0b,0x1,16000},
    {0x84,0x0b,0x1,16504},
    {0x88,0x0b,0x1,17000},
    {0x8c,0x0b,0x1,17504},
    {0x90,0x0b,0x1,18000},
    {0x94,0x0b,0x1,18504},
    {0x98,0x0b,0x1,19000},
    {0x9c,0x0b,0x1,19504},
    {0xa0,0x0b,0x1,20000},
    {0xa4,0x0b,0x1,20504},
    {0xa8,0x0b,0x1,21000},
    {0xac,0x0b,0x1,21504},
    {0xb0,0x0b,0x1,22000},
    {0xb4,0x0b,0x1,22504},
    {0xb8,0x0b,0x1,23000},
    {0xbc,0x0b,0x1,23504},
    {0xc0,0x0b,0x1,24000},
    {0xc4,0x0b,0x1,24504},
    {0xc8,0x0b,0x1,25000},
    {0xcc,0x0b,0x1,25504},
    {0xd0,0x0b,0x1,26000},
    {0xd4,0x0b,0x1,26504},
    {0xd8,0x0b,0x1,27000},
    {0xdc,0x0b,0x1,27504},
    {0xe0,0x0b,0x1,28000},
    {0xe4,0x0b,0x1,28504},
    {0xe8,0x0b,0x1,29000},
    {0xec,0x0b,0x1,29504},
    {0xf0,0x0b,0x1,30000},
    {0xf4,0x0b,0x1,30504},
    {0xf8,0x0b,0x1,31000},
    {0xfc,0x0b,0x1,31504},
    //32x
    {0x80,0x0f,0x1,32000},
    {0x84,0x0f,0x1,33008},
    {0x88,0x0f,0x1,34000},
    {0x8c,0x0f,0x1,35008},
    {0x90,0x0f,0x1,36000},
    {0x94,0x0f,0x1,37008},
    {0x98,0x0f,0x1,38000},
    {0x9c,0x0f,0x1,39008},
    {0xa0,0x0f,0x1,40000},
    {0xa4,0x0f,0x1,41008},
    {0xa8,0x0f,0x1,42000},
    {0xac,0x0f,0x1,43008},
    {0xb0,0x0f,0x1,44000},
    {0xb4,0x0f,0x1,45008},
    {0xb8,0x0f,0x1,46000},
    {0xbc,0x0f,0x1,47008},
    {0xc0,0x0f,0x1,48000},
    {0xc4,0x0f,0x1,49008},
    {0xc8,0x0f,0x1,50000},
    {0xcc,0x0f,0x1,51008},
    {0xd0,0x0f,0x1,52000},
    {0xd4,0x0f,0x1,53008},
    {0xd8,0x0f,0x1,54000},
    {0xdc,0x0f,0x1,55008},
    {0xe0,0x0f,0x1,56000},
    {0xe4,0x0f,0x1,57008},
    {0xe8,0x0f,0x1,58000},
    {0xec,0x0f,0x1,59008},
    {0xf0,0x0f,0x1,60000},
    {0xf4,0x0f,0x1,61008},
    {0xf8,0x0f,0x1,62000},
    {0xfc,0x0f,0x1,63008},
    //64x
    {0x80,0x1f,0x1,64000},
    {0x84,0x1f,0x1,66016},
    {0x88,0x1f,0x1,68000},
    {0x8c,0x1f,0x1,70016},
    {0x90,0x1f,0x1,72000},
    {0x94,0x1f,0x1,74016},
    {0x98,0x1f,0x1,76000},
    {0x9c,0x1f,0x1,78016},
    {0xa0,0x1f,0x1,80000},
    {0xa4,0x1f,0x1,82016},
    {0xa8,0x1f,0x1,84000},
    {0xac,0x1f,0x1,86016},
    {0xb0,0x1f,0x1,88000},
    {0xb4,0x1f,0x1,90016},
    {0xb8,0x1f,0x1,92000},
    {0xbc,0x1f,0x1,94016},
    {0xc0,0x1f,0x1,96000},
    {0xc4,0x1f,0x1,98016},
    {0xc8,0x1f,0x1,100000},
    {0xcc,0x1f,0x1,102016},
    {0xd0,0x1f,0x1,104000},
    {0xd4,0x1f,0x1,106016},
    {0xd8,0x1f,0x1,108000},
    {0xdc,0x1f,0x1,110016},
    {0xe0,0x1f,0x1,112000},
    {0xe4,0x1f,0x1,114016},
    {0xe8,0x1f,0x1,116000},
    {0xec,0x1f,0x1,118016},
    {0xf0,0x1f,0x1,120000},
    {0xf4,0x1f,0x1,122016},
    {0xf8,0x1f,0x1,124000},
    {0xfc,0x1f,0x1,126016},
 
};
#define NUM_OF_GAIN (sizeof(gain_table) / sizeof(GAIN_TABLE))
static int SetSensorGain(sensor_t *sensor, uint64_t gain)
{
    uint8_t data = 0 ,i = 0;
    uint8_t b_downto16 = 0, b_downto8 = 0, b_upto16 = 0, b_upto32 = 0;
    uint8_t fine_gain = 0, coarse_gain = 0, dgain = 0;

    SCCB_Read_Reg16(sensor->slv_addr, 0x3974, &data); // 0x3974 detect temperature
    if (data >= 0x18){
        if (MAX_AGAIN == 32)//32x down to 16x
        {
            b_downto16 = 1;
        }else if (MAX_AGAIN == 16) //16x down to 8x
        {
            b_downto8 = 1;
        }
    }else if (data <= 0x10){
        if(MAX_AGAIN == 8) //8x up to 16x
        {
            b_upto16 = 1;
        }else if (MAX_AGAIN == 16) //16x ip to 32x
        {
            b_upto32 = 1;
        }
    }
 
    //Modify the coefficient of 0.8 to adjust the maximum number of frames required for the 0x3974 value to reach the stable state  
    if ((b_downto16 == 1) && (MAX_AGAIN > 16)){
        MAX_AGAIN  = MAX_AGAIN * 0.8;
        if (MAX_AGAIN <= 16){
            MAX_AGAIN = 16;  
        MAX_AGAIN = 16;
            MAX_AGAIN = 16;  
            b_downto16 = 0;
        }
    }
    if ((b_downto8 == 1) && (MAX_AGAIN > 8)){
        MAX_AGAIN = MAX_AGAIN * 0.8;
        if (MAX_AGAIN <= 8){
            MAX_AGAIN = 8;
            b_downto8 = 0;
        }
    }
    //  Modify the coefficient of 1.2 to adjust the maximum number of frames required for the 0x3974 value to reach the stable state
    if ((b_upto16 == 1) && (MAX_AGAIN < 16)){
        MAX_AGAIN  = MAX_AGAIN * 1.2; 
        if (MAX_AGAIN >= 16){
            MAX_AGAIN = 16;
            b_upto16 = 0;
        }
    }
    if ((b_upto32 == 1) && (MAX_AGAIN < 32)){
        MAX_AGAIN =MAX_AGAIN * 1.2;
        if (MAX_AGAIN >= 32){
            MAX_AGAIN = 32;
            b_upto32 = 0;
        }
    }   

	if (gain < 1000) {
		gain = 1000;
	} else if (gain > (MAX_AGAIN*2000)) {
		gain = MAX_AGAIN*2000;
	}
    // search most suitable gain into gain table
	for (i=0; i<NUM_OF_GAIN; i++) {
		if (gain_table[i].totol_gain > gain){
		break;
        }
	}

    fine_gain = gain_table[i-1].DIG_FINE;
    coarse_gain = gain_table[i-1].ANG;
    dgain = gain_table[i-1].DIG;

    BL_LOGD("\t\t fine_gain 0x%02x, coarse_gain 0x%02x, dgain 0x%02x\r\n", fine_gain, coarse_gain, dgain);
    SCCB_Write_Reg16(sensor->slv_addr, 0x3E09, coarse_gain & 0xFF);    
    SCCB_Write_Reg16(sensor->slv_addr, 0x3E06, dgain & 0xFF);    
    SCCB_Write_Reg16(sensor->slv_addr, 0x3E07, fine_gain & 0xFF); 
    return 0;
}

static int SetSensorIntt(sensor_t *sensor, uint32_t intt)
{

    uint8_t data1 = 0, data2 = 0,data3 = 0, data4 = 0, data5 = 0;
    uint32_t MIN_SHUTTER_TIME =12;
    uint32_t MAX_SHUTTER_TIME;
    // SCCB_Read_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_H, &data1); 
    // SCCB_Read_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_L, &data2); 
    // MAX_SHUTTER_TIME= (data1<<8)+ (data2 & 0xff) - 6;
    MAX_SHUTTER_TIME = sensor->total_win.height -6;
    if (intt > MAX_SHUTTER_TIME){
        intt = MAX_SHUTTER_TIME;
    }else if(intt < MIN_SHUTTER_TIME){
        intt = MIN_SHUTTER_TIME;
    }
    SCCB_Write_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_H, (intt >> 12) & 0x0f); //0x3e00 [3:0]
    SCCB_Write_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_M, (intt >> 4) & 0xff);  //0x3e01  [7:0]
    SCCB_Write_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_L, (intt << 4)& 0xf0);   //0x3e02  [7:4]
    SCCB_Read_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_H, &data3); 
    SCCB_Read_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_M, &data4);
    SCCB_Read_Reg16(sensor->slv_addr, REG_SHUTTER_TIME_L, &data5);
    return 0;
}

static int SetFlipMirrow(sensor_t *sensor, uint8_t type)
{   
    uint8_t data;
    SCCB_Read_Reg16(sensor->slv_addr, REG_FLIP_MIRROR, &data);
    if (type == FLIP_MIRROR_TYPE_NORMAL) SCCB_Write_Reg16(sensor->slv_addr, REG_FLIP_MIRROR, data | 0x00);
    else if (type == FLIP_MIRROR_TYPE_MIRROR) SCCB_Write_Reg16(sensor->slv_addr, REG_FLIP_MIRROR, data | 0x06);
    else if (type == FLIP_MIRROR_TYPE_FLIP) SCCB_Write_Reg16(sensor->slv_addr, REG_FLIP_MIRROR, data | 0x60);
    else if (type == FLIP_MIRROR_TYPE_FLIP_MIRROR) SCCB_Write_Reg16(sensor->slv_addr, REG_FLIP_MIRROR, data | 0x66);
    return 0;
}

static int SetFPS(sensor_t *sensor, uint32_t fps)
{
    uint8_t data_H, data_L;
    int total_height = 0;

    if (fps > fps_tbl.fps) return -1;
    if (fps < 1) return -1;

    if (fps == fps_tbl.fps) {
        total_height = fps_tbl.VTS;
    } else {
        total_height = fps_tbl.VTS * fps_tbl.fps / fps;
    }

    data_L = total_height & 0xff;
    data_H = total_height >> 8;

    SCCB_Write_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_H, data_H);
    SCCB_Write_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_L, data_L);
    return 0;
}

/******************************************************/
static int set_exposure(sensor_t *sensor, BL_EXPO_TIME expo_time)
{
    int num_line = NS_TO_SEC(expo_time * (uint64_t)(sensor->total_win.height) * (uint64_t)(sensor->fps));
    SetSensorIntt(sensor, num_line);
    return 0;
}

static int set_gain(sensor_t *sensor, BL_GAIN_DB gain)
{
    uint64_t gain2 = 0;
    gain2 = pow(2, (GAIN_DB_INT_TO_FLOAT(gain)/6)) * 1000;
    SetSensorGain(sensor, gain2);
    return 0;
}

static int set_flipmirror(sensor_t *sensor, FLIP_MIRROR_TYPE_E type)
{
    uint8_t type_e = type;
    SetFlipMirrow(sensor, type_e);
    return 0;
}

static int set_fps(sensor_t *sensor, uint32_t fps)
{
    int ret = 0;
    ret = SetFPS(sensor, fps);
    sensor->max_expo_time = INT_TO_EXPO_TIME(fps);
    return ret;
}

static void inti_fps_tbl(sensor_t *sensor)
{
    uint8_t data_H, data_L;

    SCCB_Read_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_H, &data_H);
    SCCB_Read_Reg16(sensor->slv_addr, REG_TOTAL_HEIGHT_L, &data_L);

    fps_tbl.VTS = data_H;
    fps_tbl.VTS = (fps_tbl.VTS << 8) + (data_L & 0xff);
    fps_tbl.fps = sensor->fps;
    //printf("===== VTS: %d, fps: %d, data: H:0x%x, L:0x%x\r\n",
    //    fps_tbl.VTS, fps_tbl.fps, data_H, data_L);
}

static int setFmt(sensor_t *sensor)
{
    int i;
    FORMAT_INDEX format_index = FORMAT_INDEX_INVALID;
    const sensor_reg_16_8_t *init_reglist = init_reglist_25fps;

    switch (sensor->video_mode) {
    case VIDEO_MODE_1080P_15:
        if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
            format_index = FORMAT_INDEX_MIPI_2_LANE_1080P_15;
            init_reglist = init_reglist_MIPI_2lane_1080p_15fps;
        } else {
            return -1;
        }
        sensor->max_expo_time = EXPO_TIME_1_15_SEC;
        sensor->out_win.width  = 1920;
        sensor->out_win.height = 1080;
        break;
    case VIDEO_MODE_1080P_25:
        if (DSP2_INPUT_MIPI_1LANE == DSP2_INPUT_MODE) {
            format_index = FORMAT_INDEX_MIPI_1_LANE_1080P_25;
            init_reglist = init_reglist_MIPI_1lane_1080p_25fps;
        }
        else if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
            format_index = FORMAT_INDEX_MIPI_2_LANE_1080P_25;
            init_reglist = init_reglist_MIPI_2lane_1080p_25fps;
        } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
            format_index = FORMAT_INDEX_DVP_1080P_25;
            init_reglist = init_reglist_25fps;
        } else {
            return -1;
        }
        sensor->max_expo_time = EXPO_TIME_1_25_SEC;       /* 1/25 sec */
        sensor->out_win.width  = 1920;
        sensor->out_win.height = 1080;
        break;
    case VIDEO_MODE_720P_59_94:
            if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_MIPI_2_LANE_720P_60;
                init_reglist = init_reglist_MIPI_2lane_720p_60fps;
            } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_DVP_720P_60;
                init_reglist = init_reglist_720p_60fps;
            } else {
                return -1;
            }
            sensor->max_expo_time = EXPO_TIME_1_60_SEC;
            sensor->out_win.width  = 1280;
            sensor->out_win.height = 720;
            break;
    case VIDEO_MODE_720P_50:
            if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_MIPI_2_LANE_720P_50;
                init_reglist = init_reglist_MIPI_2lane_720p_50fps;
            } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_DVP_720P_30;
                init_reglist = init_reglist_720p_30fps;
            } else {
                return -1;
            }
            sensor->max_expo_time = EXPO_TIME_1_30_SEC;
            sensor->out_win.width  = 1280;
            sensor->out_win.height = 720;
            break;
    case VIDEO_MODE_720P_30:
            if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_MIPI_2_LANE_720P_30;
                init_reglist = init_reglist_MIPI_2lane_720p_30fps;
            } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_DVP_720P_30;
                init_reglist = init_reglist_720p_30fps;
            } else {
                return -1;
            }
            sensor->max_expo_time = EXPO_TIME_1_30_SEC;
            sensor->out_win.width  = 1280;
            sensor->out_win.height = 720;
            break;
    case VIDEO_MODE_720P_25:
            if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_MIPI_2_LANE_720P_25;
                init_reglist = init_reglist_MIPI_2lane_720p_25fps;
            } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_DVP_720P_30;
                init_reglist = init_reglist_720p_30fps;
            } else {
                return -1;
            }
            sensor->max_expo_time = EXPO_TIME_1_30_SEC;
            sensor->out_win.width  = 1280;
            sensor->out_win.height = 720;
            break;
    case VIDEO_MODE_1080P_30:
            if (DSP2_INPUT_MIPI_2LANE == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_MIPI_2_LANE_1080P_30;
                init_reglist = init_reglist_MIPI_2lane_1080p_30fps;
            } else if (DSP2_INPUT_DVP == DSP2_INPUT_MODE) {
                format_index = FORMAT_INDEX_DVP_1080P_30;
                init_reglist = init_reglist_30fps;
            } else {
                return -1;
            }
            sensor->max_expo_time = EXPO_TIME_1_30_SEC;
            sensor->out_win.width  = 1920;
            sensor->out_win.height = 1080;
            break;

    default:
        BL_LOGE("set_format error: invalid video mode!\r\n");
        return -1;
    }

    sensor->pix_clk             = format_info[format_index].pix_clk;
    sensor->fps                 = format_info[format_index].fps;
    sensor->total_win.width     = format_info[format_index].total_width;
    sensor->total_win.height    = format_info[format_index].total_height;
    sensor->bayer_pattern       = format_info[format_index].bayer_pattern;

    for (i = 0; init_reglist[i].addr != REGLIST_END; i++) {
        SCCB_Write_Reg16(sensor->slv_addr, init_reglist[i].addr, (uint8_t)init_reglist[i].data);
    }
    vTaskDelay(10);
    inti_fps_tbl(sensor);
    return 0;
}

static int get_property(sensor_t *sensor, sensor_property_t *property)
{
    CHECK_PARAM(sensor != NULL);

    property->bayer_pattern = sensor->bayer_pattern;//BAYER_PATTERN_BG;

    return 0;
}

static int probe(void)
{
    return sensor_probe(SLAVE_ADDR, REG_SENSOR_ID_H, REG_SENSOR_ID_L, SENSOR_ID_H, SENSOR_ID_L);
}

static int init(sensor_t *sensor)
{
    int mode_num = sizeof(sc2336_mode)/sizeof(sc2336_mode[0]);
    if (!is_sensor_dsp2_input_match(sc2336_mode, mode_num)) {
        return -1;
    }

    /* Initialize sensor structure */
    SENSOR_INIT_COMMON(SC2336);

    //set_format(sensor, VIDEO_MODE_1080P_25);

if (enable_test_pattern == 1)  // enable test pattern
{
    SCCB_Write_Reg16(sensor->slv_addr, REG_test_pattern, 0xc8);     /* test pattern enable */
    SCCB_Write_Reg16(sensor->slv_addr, 0x3902, 0x05);     /* manual BLC  */
}else{
    SCCB_Write_Reg16(sensor->slv_addr, REG_test_pattern, 0xc4);     /* test pattern disable */
    SCCB_Write_Reg16(sensor->slv_addr, 0x3902, 0x25);     /* auto BLC  */
}
if (enable_sensor_dpc == 1)  // enable sensor dpc
{
    SCCB_Write_Reg16(sensor->slv_addr, REG_sensor_dpc, 0x06);     /* sensor dpc enable */
}else{
    SCCB_Write_Reg16(sensor->slv_addr, REG_sensor_dpc, 0x00);     /* sensor dpc disable */
}
    return 0;
}

const BL_SENSOR_DESC_T sensor_desc_sc2336 ATTR_SENSOR_DEVICE_TABLE =
{
    "SC2336",
    SLAVE_ADDR,
    probe,
    init,
    setFmt,
};

